\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#

检测订单

\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#

1.第三方订单id

保存第三方服务平台接口

\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#

2. 回调cp接口

2.1重试3次

重试 retrying 包

2.2 同步调用商品更新

update\_product\_status

商品状态更新函数

def cp\_func\(\):

	pass

根据cp\_func的状态。去更新商品的状态。

\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#

3.加密



msgpack



4.响应状态



0 成功



1 失败



2 重复

\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#



5.CP callback interface 



request params:



sdk\_id:账户



sz\_order\_id:炫综提供的订单号



game\_id:游戏ID



game\_product\_id:用户购买商品的唯一标识



amount:商品的数量



currency:货币的种类



plaform\_id:支付平台



platform\_order\_id:平台支付的订单号





params = {'sdk\_id': '', 'sz\_order\_id':'', 'game\_id':'', 'game\_product\_id':'', 'amount':'', \

		   'currency':'', 'platform\_id':'', 'platform\_order\_id':''}



这里params 参数会用msgpack 做加密处理



response :



0 商品下发成功



1 商品下发失败



2 商品下发重复



{'msg':'successful', 'timestamp':1233455535, code:0, data:''}



这里params 参数会用msgpack 做加密处理



成功：data 返回空值



失败：data 返回具体异常， 这里会根据code做3次重试调用



重复：data  返回空值

\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#



接口设计（同步API）



1.CP调用订单检测接口



2.这里open-api sever 回调CP-sever接口，发送请求参数后， 根据参数验证用户的支付状态的，这里client可能会多次请求sevrer，保持同步状态，或者加锁



必须保证该操的原子性



3. 根据用户信息，检测用户付款状态， client获得支付状态后， 根据支付状态去更新支付表信息，同步调用商品下发接口，完成检验



4.把open-api server 的信息响应到SDK client

































